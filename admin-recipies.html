<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Recipes</title>
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="../css/admin.css">
    <link rel="shortcut icon" href="../img/12.png" type="image/x-icon">
</head>
<body>
    <header>
        <a href="#" class="logo"><i class="fas fa-utensils"></i>Admin Panel</a>
        <nav class="navbar">
            <a href="admin.html">Dashboard</a>
            <a href="admin-menu.html">Dishes</a>
            <a href="admin-orders.html">Orders</a>
            <a href="admin-reservations.html">Reservations</a>
            <a href="admin-users.html">Users</a>
            <a href="admin-messages.html">Messages</a>
            <a href="admin-recipies.html">Recipies</a>
        </nav>
        <div class="icons">
            <i class="fas fa-bars" id="menu-bars"></i>
            <a href="#" id="logoutBtn" class="fas fa-sign-out-alt"></a>
        </div>
    </header>
    <h1> Manage Recipes</h1>
    <h2>uplode Recipes</h2>
    <form id="recipeForm"class="addChefForm" enctype="multipart/form-data">
        <input type="hidden" id="recipeId" name="id">
        <input type="text" id="title" name="title" placeholder="Title">
        <input type="file" id="image" name="image">
        <img id="preview" style="display:none; width:80px; margin-top:5px;">
        <input id="remedy" name="remedy" placeholder="Remedy">
         <button type="submit" class="btn">Save Recipe</button>
    </form>
    <h2>All Recipes</h2>
    <table>
        <thead>
            <tr>
                <th>Title</th>
                <th>Image</th>
                <th>Remedy</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="recipeTable"></tbody>
    </table>
    <footer class="footer">
        <div class="credit">Admin Panel Â© 2025 - <span>Taste Haven</span></div>
    </footer>
    <script>
        const API_URL = "http://localhost:8080/api/recipes";

            // Handle form submit
            document.getElementById("recipeForm").addEventListener("submit", async function (e) {
                e.preventDefault();

                let formData = new FormData(this);

                let response = await fetch(API_URL, {
                    method: "POST",
                    body: formData
                });
                let result = await response.json();
                alert(result.message);
                loadRecipes(); 
                this.reset();
            });
            // Load all recipes
            async function loadRecipes() {
                    let res = await fetch(API_URL);
                    let recipes = await res.json();
                    let table = document.getElementById("recipeTable");
                    table.innerHTML = "";
                    recipes.forEach(r => {
                        let row = document.createElement("tr");
                        row.innerHTML = `
      <td>${r.title}</td>
      <td><img src="http://localhost:8080/uploads/${r.image}" width="80"></td>
      <td>${r.remedy}</td>
      <td>
          <button class="delete-btn" onclick="deleteRecipe('${r._id}')">Delete</button>
      </td>
    `;
                        table.appendChild(row);
                    });
                }
    function editRecipe(id, title, remedy, image) {
        document.getElementById("recipeId").value = id; // hidden input
        document.getElementById("title").value = title;
        document.getElementById("remedy").value = remedy;

        if (image) {
            document.getElementById("preview").src = "http://localhost:8080/uploads/" + image;
            document.getElementById("preview").style.display = "block";
        }
    }
            // Delete recipe
            async function deleteRecipe(id) {
                if (confirm("Delete this recipe?")) {
                    let res = await fetch(API_URL + "/" + id, { method: "DELETE" });
                    let result = await res.json();
                    alert(result.message);
                    loadRecipes();
                }
            }
            // Load on start
            loadRecipes();
        </script>
        <script src="../script/admin.js"></script>